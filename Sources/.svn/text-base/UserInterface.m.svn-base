%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%       Matlab Pore Network Modeling      %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%           Outil de maillage             %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Description : prend un fichier de géométrie macroscopique et construit un
%fichier réseau de pore adapé à cette géométrie.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
clc;
disp('Bonjour, c''est le Mailleur qui vous parle.');

%demande à l'utilisateur  le nom du fichier de géométrie macroscopique
file_name = input('Entrez un nom de fichier pour la géométrie macroscopique s''il vous plaît : \n');

%charger le fichier de géométrie macroscopique
reader=FileReaderXML(file_name);
file_content=reader.Read();

%construire le réseau de pores à partir du fichier de géométrie macroscopique
mailleur=Mailleur(reader.Read);
reader.delete;clear('reader');
disp('Génération du réseau...');
tic;
network= mailleur.BuildNetwork;

duree=toc;minutes=floor(duree/60);secondes=duree-60*minutes;
disp(sprintf('Réseau généré. Durée : %d minutes %f s.',minutes,secondes));
clear('file_name','file_content','duree','minutes','secondes');

%écriture du réseau obtenu dans un fichier VTK ?
foo=input('Voulez vous écrire un fichier de visualisation VTK (géométrie seule) ? n=Non, y=Oui \n');
if strcmp(foo,'y')
    file_name=input('Entrez un nom de fichier pour visualiser le réseau de pores dans paraview s''il vous plaît : \n');
    writer=FileWriterVTK(file_name);
    tic;
    disp('Génération du fichier VTK...');
    donnees_output=network.VTKOutputStruct;
    writer.Write(donnees_output);
    duree=toc;minutes=floor(duree/60);secondes=duree-60*minutes;
    disp(sprintf('Fichier VTK généré. Durée : %d minutes %f s.',minutes,secondes));

    writer.delete;clear('writer','file_name','file_content','donnees_output','duree','minutes','secondes');
    
else
    visualisateur=Visualisateur(network.InternalOutputStruct);
end

clear('mailleur','foo');








